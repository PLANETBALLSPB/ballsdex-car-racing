<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BallsDex Car Racing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>ğŸ BallsDex Car Racing</h1>
<p class="subtitle">SimulaciÃ³n automÃ¡tica</p>

<div id="track">
  <div class="lane"></div>
  <div class="lane"></div>
</div>

<p id="status">â³ Cargando carrera...</p>

<script>
(async () => {
  try {
    const response = await fetch("race.json", { cache: "no-store" });
    const data = await response.json();

    startRace(data);
  } catch (e) {
    document.getElementById("status").textContent =
      "âŒ Error cargando race.json";
  }
})();

function startRace(data) {
  const track = document.getElementById("track");
  const status = document.getElementById("status");

  const car1 = document.createElement("div");
  car1.className = "car";
  car1.style.backgroundImage = `url(${data.player1.avatar})`;
  car1.style.top = "40px";

  const car2 = document.createElement("div");
  car2.className = "car";
  car2.style.backgroundImage = `url(${data.player2.avatar})`;
  car2.style.top = "140px";

  track.appendChild(car1);
  track.appendChild(car2);

  let pos1 = 0;
  let pos2 = 0;
  let lap = 1;
  const maxLaps = 3;
  const finish = 640;

  status.textContent = `ğŸš¦ Vuelta ${lap}/${maxLaps}`;

  const raceInterval = setInterval(() => {
    pos1 += data.player1.speed;
    pos2 += data.player2.speed;

    car1.style.left = pos1 + "px";
    car2.style.left = pos2 + "px";

    if (pos1 >= finish || pos2 >= finish) {
      lap++;

      if (lap > maxLaps) {
        clearInterval(raceInterval);
        const winner =
          pos1 > pos2 ? data.player1.name : data.player2.name;
        status.textContent = `ğŸ† Ganador: ${winner}`;
        return;
      }

      pos1 = 0;
      pos2 = 0;
      status.textContent = `ğŸ” Vuelta ${lap}/${maxLaps}`;
    }
  }, 50);
}
</script>

</body>
</html>
